<!DOCTYPE html>
<html>
<head>
    <title>My Orders - NovaCart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container mt-5">
        <h2 class="mb-4">My Orders</h2>
        <div id="order-list"></div>
    </div>

<script>
async function loadOrders() {
    try {
        const response = await fetch("http://localhost:5000/orders");
        const orders = await response.json();

        const orderList = document.getElementById("order-list");
        orderList.innerHTML = "";

        if (!orders || orders.length === 0) {
            orderList.innerHTML = `
                <div class="alert alert-info">
                    No orders yet üì¶
                </div>
            `;
            return;
        }

        // Latest order first
        orders.slice().reverse().forEach(order => {

            // ‚úÖ Convert string back to array
            const items = JSON.parse(order.items);

            let itemsHTML = "";

            items.forEach(item => {
                itemsHTML += `
                    <div class="d-flex justify-content-between border-bottom py-2">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>Qty: ${item.quantity}</small>
                        </div>
                        <div>‚Çπ${item.price * item.quantity}</div>
                    </div>
                `;
            });
            orderList.innerHTML += `
                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="text-primary">Order ID: ${order.id}</h5>
                        <p class="text-muted">Date: ${order.created_at}</p>
                        <p>Status: 
                            <span class="badge bg-warning">${order.status}</span>
                        </p>
                        ${itemsHTML}
                        <div class="text-end mt-3">
                            <h5 class="text-success">Total: ‚Çπ${order.total}</h5>
                        </div>
                    </div>
                </div>0
            `;
        });

    } catch (error) {
        console.error("Error loading orders:", error);
        document.getElementById("order-list").innerHTML = `
            <div class="alert alert-danger">
                Failed to load orders ‚ùå
            </div>
        `;
    }
}

loadOrders();
</script>

</body>
</html>
